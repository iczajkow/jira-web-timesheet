(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{218:function(e,t,n){e.exports=n(415)},223:function(e,t,n){},224:function(e,t,n){},245:function(e,t,n){},377:function(e,t,n){},382:function(e,t,n){},383:function(e,t,n){},384:function(e,t,n){},405:function(e,t,n){},406:function(e,t,n){},407:function(e,t,n){},408:function(e,t,n){},409:function(e,t,n){},415:function(e,t,n){"use strict";n.r(t);var r,a=n(0),o=n.n(a),c=n(8),l=n.n(c),i=(n(223),n(224),n(21)),u=n(23);!function(e){e.SetUser="APP_SET_USER",e.ClearUser="APP_CLEAR_USER",e.SetAuthenticated="APP_SET_AUTHENTICATED",e.Logout="APP_LOGOUT"}(r||(r={}));var s,m=function(e){return{type:r.SetUser,payload:e}},f=Object(i.b)(r.SetAuthenticated),d=Object(i.b)(r.Logout),p=Object(i.b)(r.ClearUser);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O,h={url:null,user:null,isAuthenticated:void 0},E=Object(i.c)(h,(s={},Object(u.a)(s,r.SetUser,(function(e,t){return b({},e,{user:t.payload.user,url:t.payload.url})})),Object(u.a)(s,r.ClearUser,(function(e){return b({},e,{user:null,isAuthenticated:!1})})),Object(u.a)(s,r.SetAuthenticated,(function(e,t){return b({},e,{isAuthenticated:t.payload})})),s)),y=n(35);!function(e){e.Login="LOGIN_LOGIN",e.LoginSuccess="LOGIN_SUCCESS",e.SetError="LOGIN_SET_ERROR"}(O||(O={}));var j,v=Object(i.b)(O.Login),w=Object(i.b)(O.LoginSuccess),k=Object(i.b)(O.SetError);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var L,P=Object(i.c)({isLoggingIn:!1,error:null},(j={},Object(u.a)(j,O.Login,(function(e){return _({},e,{isLoggingIn:!0})})),Object(u.a)(j,O.LoginSuccess,(function(e){return _({},e,{isLoggingIn:!1})})),Object(u.a)(j,O.SetError,(function(e,t){return _({},e,{error:t.payload,isLoggingIn:!1})})),j));!function(e){e.LoadWorklogs="WORKLOGS_LOAD",e.LoadedWorklogs="WORKLOGS_LOADED",e.ErrorLoadingWorklogs="WORKLOGS_ERROR"}(L||(L={}));var N,D=Object(i.b)(L.LoadWorklogs),I=Object(i.b)(L.LoadedWorklogs),A=Object(i.b)(L.ErrorLoadingWorklogs);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=Object(i.c)({isFetchingWorklogs:!1,month:null,year:null,day:null,user:null,worklogs:null,error:null},(N={},Object(u.a)(N,L.LoadWorklogs,(function(e,t){return C({},e,{user:t.payload.user,month:t.payload.month,year:t.payload.year,day:t.payload.day,isFetchingWorklogs:!0,error:null})})),Object(u.a)(N,L.LoadedWorklogs,(function(e,t){return C({},e,{worklogs:t.payload,isFetchingWorklogs:!1})})),Object(u.a)(N,L.ErrorLoadingWorklogs,(function(e,t){return C({},e,{error:t.payload,isFetchingWorklogs:!1})})),N)),T=Object(y.combineReducers)({appState:E,login:P,worklogs:Y}),U=n(18),W=n(46),F=n.n(W),M=function(){return F.a.get("/api/users/current")},K=function(e){return function(t){t(v()),function(e){return F.a.post("/api/users/authenticate",e)}(e).then((function(){return t(w()),M()})).then((function(e){t(m(e.data)),t(f(!0))})).catch((function(e){t(k(e.response&&e.response.status))}))}},x=function(){return function(e){e(d()),F.a.post("api/users/logout").then((function(){return e(p())}))}},G=n(69),z=n(56),q=(n(245),n(423)),B=n(422),H=n(426),V=n(427),J=n(162),Z=q.a.Text,Q=B.a.create({name:"login"})((function(e){var t=e.onSubmit,n=e.isLoggingIn,r=e.loginError,a=e.form,c=a.getFieldDecorator;return o.a.createElement(B.a,{onSubmit:function(e){e.preventDefault(),a.validateFields((function(e,n){e||t(n)}))}},o.a.createElement(B.a.Item,null,c("email",{rules:[{required:!0,message:"Please input your email"}]})(o.a.createElement(H.a,{placeholder:"Email"}))),o.a.createElement(B.a.Item,null,c("url",{rules:[{required:!0,message:"Please input URL"}]})(o.a.createElement(H.a,{addonBefore:"https://",placeholder:"URL"}))),o.a.createElement(B.a.Item,null,c("apiToken",{rules:[{required:!0,message:"Please input token"}]})(o.a.createElement(H.a,{placeholder:"Token"}))),o.a.createElement(B.a.Item,null,c("rememberMe",{valuePropName:"checked",initialValue:!0})(o.a.createElement(V.a,null,"Remember me"))),o.a.createElement(J.a,{loading:n,type:"primary",htmlType:"submit",className:"login-form__button"},"Log in"),r&&o.a.createElement("div",{className:"login-form__error"},o.a.createElement(Z,{type:"danger"},"Incorrect login data")))})),X=n(417),$=n(74),ee=n(41),te=n(420),ne=(n(377),function(){var e=Object(U.c)(),t=Object(U.d)((function(e){return e.appState.isAuthenticated})),n=Object(U.d)((function(e){return e.login.isLoggingIn})),r=Object(U.d)((function(e){return e.login.error}));return t?o.a.createElement(z.a,{to:{pathname:"dashboard"}}):o.a.createElement(X.a,{style:{height:"100%"}},o.a.createElement(X.a.Content,{style:{padding:"50px 50px"}},o.a.createElement($.a,{className:"login__card-wrapper"},o.a.createElement(ee.a,{md:{span:12,offset:6},xl:{span:8,offset:8}},o.a.createElement(te.a,{className:"login__card"},o.a.createElement("h2",null,"Sign in"),o.a.createElement(Q,{onSubmit:function(t){return K(t)(e)},isLoggingIn:n,loginError:r}))))))}),re=n(88),ae=n(418),oe=n(63),ce=n(14),le=n.n(ce),ie=function(e){var t=e.from,n=e.to,r=e.user,a=function(e){var t=e.from,n=e.to;return{from:le()(t).format("YYYY-MM-DD"),to:le()(n).format("YYYY-MM-DD")}}({from:t,to:n});return F.a.get("/api/worklogs?from=".concat(a.from,"&to=").concat(a.to,"&accountId=").concat(r.accountId))},ue=n(161),se=n.n(ue),me=function(e){return{from:e.startOf("month").toDate(),to:e.endOf("month").toDate()}};var fe=n(210),de=n(425),pe=n(10),ge=n(424),be=n(127);function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ee=function(e,t){return e?e.reduce((function(e,n){return function(e,t){var n=Object.assign({},e);return Object.keys(t).reduce((function(e,n){var r=t[n],a=e[n]||[],o=[].concat(Object(be.a)(a),Object(be.a)(r));return he({},e,Object(u.a)({},n,o))}),n)}(e,n.worklogs.reduce((function(e,r){var a=function(e,t){return se.a.tz(se()(e),t)}(r.started,t).format("YYYY-MM-DD"),o=e[a]||[],c=[].concat(Object(be.a)(o),[{issueKey:n.issueKey,timeSpent:r.timeSpentSeconds,started:r.started}]);return he({},e,Object(u.a)({},a,c))}),{}))}),{}):{}},ye=(n(382),function(e){var t=Math.floor(e/3600),n=e/60%60,r=n<10?"0".concat(n):"".concat(n);return"".concat(t,":").concat(r)}),je=function(e,t){return"https://".concat(e,"/browse/").concat(t)},ve=q.a.Text,we=function(e,t){return function(n){var r=n.format("YYYY-MM-DD"),a=e[r],c=a&&a.reduce((function(e,t){return e+t.timeSpent}),0),l=28800===c;return o.a.createElement("div",{className:"ant-fullcalendar-date"},o.a.createElement("div",{className:"ant-fullcalendar-value callendar-cell__header"},a&&o.a.createElement("span",{className:"callendar-cell__total-time"},o.a.createElement(ve,{type:l?void 0:"warning"},"Total: ",ye(c)," ")),o.a.createElement("span",{className:"callendar-cell__day"},n.date())),o.a.createElement("div",{className:"ant-fullcalendar-content"},a&&o.a.createElement("div",null,o.a.createElement("ul",{className:"worklogs"},a.map((function(e,n){return o.a.createElement("li",{className:"worklog-list-item",key:"".concat(e.issueKey,"_").concat(n)},o.a.createElement("a",{target:"_blank",href:je(t,e.issueKey)},e.issueKey),o.a.createElement("span",null,ye(e.timeSpent)))}))))))}},ke=(n(383),n(52)),Se=(n(384),n(70)),_e=n.n(Se),Le=function(e){return function(t){var n;e({data:[],fetching:!0}),t&&(n=t,F.a.get("/api/users/search",{params:{query:n}})).then((function(e){return e.data})).then((function(t){e({data:t,fetching:!1})}))}},Pe=function(e){var t=e.user,n=e.onUserSelect,r=Object(a.useState)({data:[],value:t.displayName,fetching:!1}),o=Object(re.a)(r,2),c=o[0],l=o[1],i=_e()(Le(l),800);return a.createElement("div",{className:"user__search"},a.createElement(ke.a,{showSearch:!0,style:{width:"100%"},placeholder:"Select user",value:c.value,onSearch:i,onChange:function(e){var t=c.data.find((function(t){return t.accountId===e}));l({value:t&&t.displayName,data:[],fetching:!1}),t&&n(t)},showArrow:!1,filterOption:!1,defaultActiveFirstOption:!1,notFoundContent:c.fetching?a.createElement(fe.a,{size:"small"}):null},c.data.map((function(e){return a.createElement(ke.a.Option,{key:e.accountId},e.displayName)}))))},Ne=function(e){var t=e.url,n=e.onViewChanged,r=e.onRefresh,c=e.isFetchingWorklogs,l=e.worklogs,i=e.selectedDate,u=e.totalLoggedTime,s=e.userWorklogs;Object(a.useEffect)((function(){return window.addEventListener("keyup",p),function(){window.removeEventListener("keyup",p)}}));var m=function(e){e&&n(e,s)},f=function(){var e=i.clone().add(1,"month");m(e)},d=function(){var e=i.clone().subtract(1,"month");m(e)},p=function(e){switch(e.key){case"ArrowLeft":d();break;case"ArrowRight":f();break;case"r":r()}},g=we(l,t);return o.a.createElement(fe.a,{spinning:c},o.a.createElement("div",{className:"worklog-calendar__header"},o.a.createElement("div",{className:"worklog-calendar__total-summary"},o.a.createElement(de.a,{title:"Total logged:",value:ye(u)})),o.a.createElement("div",{className:"worklog-calendar__user"},o.a.createElement(Pe,{user:s,onUserSelect:function(e){e.accountId!==s.accountId&&n(i,e)}})),o.a.createElement(J.a.Group,null,o.a.createElement(J.a,{type:"primary",onClick:d},o.a.createElement(pe.a,{type:"left"}),"Backward"),o.a.createElement(J.a,{type:"primary",onClick:r},o.a.createElement(pe.a,{type:"sync"}),"Refresh(R)"),o.a.createElement(J.a,{type:"primary",onClick:f},"Forward",o.a.createElement(pe.a,{type:"right"})))),o.a.createElement(ge.a,{value:i,onChange:m,dateFullCellRender:g}))},De=(n(405),n(421)),Ie=(n(406),n(407),function(e){var t=e.date,n=e.totalLoggedTime;return o.a.createElement("div",{className:"details__title"},o.a.createElement("span",null,t.format("ll")),o.a.createElement("span",null,ye(n)))}),Ae=function(e){return e?Ye(e)?Re(e):Ce(e):0},Re=function(e){return e.reduce((function(e,t){return e+t.worklogs.reduce((function(e,t){return e+t.timeSpentSeconds}),0)}),0)},Ce=function(e){return e.reduce((function(e,t){return e+t.timeSpent}),0)},Ye=function(e){var t=e[0];return!!t&&t.worklogs instanceof Array},Te=function(e){var t=e.jiraUrl,n=e.selectedDate,r=e.worklogs,a=Ae(r);return o.a.createElement(te.a,{className:"details-sider",title:Ie({date:n,totalLoggedTime:a})},o.a.createElement(De.a,{header:o.a.createElement("b",null,"Logged Issues:"),dataSource:r,renderItem:function(e){return o.a.createElement(De.a.Item,null,o.a.createElement(De.a.Item.Meta,{title:o.a.createElement("a",{target:"_blank",href:je(t,e.issueKey)},e.issueKey),description:o.a.createElement("div",{className:"issue__description"},o.a.createElement("span",null,"Started at: ",o.a.createElement("b",null,le()(e.started).format("lll"))),o.a.createElement("span",null,"Logged: ",o.a.createElement("b",null,ye(e.timeSpent))))}))}}))},Ue=function(e){var t=e.month,n=e.year,r=e.day;return Object(oe.isNil)(t)||Object(oe.isNil)(n)||Object(oe.isNil)(r)?le()():le()([n,t,r])},We=function(){var e=Object(U.c)(),t=function(t,n,r){var a;(a={from:t,to:n,user:r},function(e){var t=a.from.getMonth(),n=a.from.getFullYear();e(D({user:a.user,month:t,year:n})),ie(a).then((function(t){e(I(t.data))})).catch((function(){e(A())}))})(e)},n=Object(U.d)((function(e){return e.worklogs.isFetchingWorklogs})),r=Object(U.d)((function(e){return e.appState.user})),c=Object(U.d)((function(e){return e.appState.url}))||"",l=Object(U.d)((function(e){var t=e.appState.user;return t&&t.timeZone})),i=Object(U.d)((function(e){return e.worklogs.error})),u=Object(z.g)(),s=new URLSearchParams(Object(z.h)().search),m=Object(U.d)((function(e){return e.worklogs})),f=m.worklogs,d=m.month,p=m.year,g=m.day,b=m.user,O=Ee(f,l),h=Ae(f),E=Object(a.useState)(Ue({month:d,year:p,day:g})),y=Object(re.a)(E,2),j=y[0],v=y[1];Object(a.useEffect)((function(){i&&ae.a.error("Could not fetch worklogs. Please try again.")})),Object(a.useEffect)((function(){var e=me(Ue({year:s.get("year"),month:s.get("month"),day:s.get("day")})),n=e.from,a=e.to,o=s.get("user");o?function(e){var t=encodeURIComponent(e);return F.a.get("/api/users/".concat(t))}(o).then((function(e){var r=e.data;t(n,a,r)})).catch((function(){ae.a.error("Could not fetch user with accountID: ".concat(o))})):t(n,a,r)}),[]);var w=O[j.format("YYYY-MM-DD")]||[];return o.a.createElement("div",{className:"home__container"},Object(oe.isNil)(b)||Object(oe.isNil)(d)||Object(oe.isNil)(p)?"":o.a.createElement($.a,{gutter:24},o.a.createElement(ee.a,{span:18,className:"home__content"},o.a.createElement(Ne,{url:c,userWorklogs:b,isFetchingWorklogs:n,selectedDate:j,onViewChanged:function(e,n){v(e);var r=e.year(),a=e.month();if(function(e){var t=new URLSearchParams;Object.entries(e).forEach((function(e){var n=Object(re.a)(e,2),r=n[0],a=n[1];return t.set(r,a.toString())})),u.push("?".concat(t.toString()))}({year:r,month:a,day:e.date(),user:n.accountId}),a!==d||r!==p||(b&&b.accountId)!==n.accountId){var o=me(le()([r,a])),c=o.from,l=o.to;t(c,l,n)}},onRefresh:function(){if(b){var e=me(j),n=e.from,r=e.to;t(n,r,b)}},worklogs:O,totalLoggedTime:h})),o.a.createElement(ee.a,{span:6,className:"home__sider"},o.a.createElement(Te,{jiraUrl:c,selectedDate:j,worklogs:w}))))},Fe=n(214),Me=(n(408),n(428)),Ke=n(119),xe=(n(409),function(e){var t=e.user,n=e.onLogout,r=e.children;return o.a.createElement(Me.a,{theme:"dark",mode:"horizontal",className:"user-info__menu",selectable:!1},o.a.createElement(Ke.a,{title:o.a.createElement("span",null,o.a.createElement(pe.a,{type:"user"}),t.displayName)},o.a.createElement(Me.a.Item,{disabled:!0},o.a.createElement("img",{alt:"avatar",src:t.avatarUrls["32x32"],className:"user-info__avatar"}),t.emailAddress),o.a.createElement(Me.a.Item,{disabled:!0},"Timezone: ",t.timeZone),o.a.createElement(Me.a.Item,{onClick:n},o.a.createElement(pe.a,{type:"logout"}),"Logout")),r&&o.a.createElement(Me.a.Item,{className:"user-info__extras"},r))}),Ge=X.a.Header,ze=X.a.Content,qe=function(e){var t=e.children,n=Object(U.c)(),r=Object(U.d)((function(e){return e.appState.user}));return o.a.createElement(X.a,{className:"main-layout"},o.a.createElement(Ge,{className:"main-layout__header"},o.a.createElement(xe,{user:r,onLogout:function(){return n(x())}},o.a.createElement("a",{href:"https://github.com/iczajkow/jira-web-timesheet",target:"_blank"},o.a.createElement(pe.a,{type:"github",style:{fontSize:"24px"}})))),o.a.createElement(ze,{className:"main-layout__content"},t))},Be=function(e){var t=e.children,n=Object(Fe.a)(e,["children"]),r=Object(U.d)((function(e){return e.appState.isAuthenticated}));return o.a.createElement(z.b,Object.assign({},n,{render:function(e){var n=e.location;return r?o.a.createElement(qe,null,t):o.a.createElement(z.a,{to:{pathname:"/login",state:{from:n}}})}}))},He=function(){return o.a.createElement(G.a,null,o.a.createElement(z.d,null,o.a.createElement(z.b,{path:"/login"},o.a.createElement(ne,null)),o.a.createElement(Be,{path:"/dashboard"},o.a.createElement(We,null)),o.a.createElement(z.b,{path:"*"},o.a.createElement(z.a,{to:{pathname:"dashboard"}}))))},Ve={checkAuthenticationConnect:function(){return function(e){M().then((function(t){e(m(t.data)),e(f(!0))})).catch((function(){e(f(!1))}))}}},Je=Object(U.b)((function(e){return{isAuthenticated:e.appState.isAuthenticated}}),Ve)((function(e){var t=e.checkAuthenticationConnect,n=e.isAuthenticated;return o.a.useEffect((function(){t()}),[]),null!=n?o.a.createElement(He,null):null})),Ze=n(13),Qe=(n(410),n(215)),Xe=n.n(Qe),$e=function(e){var t=e.dispatch;F.a.interceptors.response.use(void 0,(function(e){return 401===e.response.status&&t(p()),Promise.reject(e)}))},et=n(419),tt=function(){"https:"===window.location.protocol||function(){var e="open".concat(Date.now()),t=o.a.createElement(J.a,{type:"primary",href:"https://".concat("jira-timesheet.iczajkow.pl")},"Open HTTPs version");et.a.open({message:"Your connection is not private!",description:"You are using unsecured version of this website. To open secured version click button below.",btn:t,key:e,duration:0})}()},nt=Object(i.a)({reducer:T});$e(nt);var rt=function(){return tt(),o.a.createElement(Ze.b,{locale:Xe.a},o.a.createElement(U.a,{store:nt},o.a.createElement(Je,null)))};l.a.render(o.a.createElement(rt,null),document.getElementById("root"))}},[[218,1,2]]]);
//# sourceMappingURL=main.771dc917.chunk.js.map