(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{216:function(e,t,n){e.exports=n(411)},221:function(e,t,n){},222:function(e,t,n){},243:function(e,t,n){},375:function(e,t,n){},380:function(e,t,n){},381:function(e,t,n){},382:function(e,t,n){},403:function(e,t,n){},404:function(e,t,n){},405:function(e,t,n){},411:function(e,t,n){"use strict";n.r(t);var r,a=n(0),o=n.n(a),c=n(8),u=n.n(c),i=(n(221),n(222),n(21)),l=n(23);!function(e){e.SetUser="APP_SET_USER",e.ClearUser="APP_CLEAR_USER",e.SetAuthenticated="APP_SET_AUTHENTICATED",e.Logout="APP_LOGOUT"}(r||(r={}));var s,m=function(e){return{type:r.SetUser,payload:e}},f=Object(i.b)(r.SetAuthenticated),d=Object(i.b)(r.Logout),p=Object(i.b)(r.ClearUser);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h,O={url:null,user:null,isAuthenticated:void 0},E=Object(i.c)(O,(s={},Object(l.a)(s,r.SetUser,(function(e,t){return b({},e,{user:t.payload.user,url:t.payload.url})})),Object(l.a)(s,r.ClearUser,(function(e){return b({},e,{user:null,isAuthenticated:!1})})),Object(l.a)(s,r.SetAuthenticated,(function(e,t){return b({},e,{isAuthenticated:t.payload})})),s)),y=n(35);!function(e){e.Login="LOGIN_LOGIN",e.LoginSuccess="LOGIN_SUCCESS",e.SetError="LOGIN_SET_ERROR"}(h||(h={}));var j,v=Object(i.b)(h.Login),w=Object(i.b)(h.LoginSuccess),k=Object(i.b)(h.SetError);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P,L=Object(i.c)({isLoggingIn:!1,error:null},(j={},Object(l.a)(j,h.Login,(function(e){return _({},e,{isLoggingIn:!0})})),Object(l.a)(j,h.LoginSuccess,(function(e){return _({},e,{isLoggingIn:!1})})),Object(l.a)(j,h.SetError,(function(e,t){return _({},e,{error:t.payload,isLoggingIn:!1})})),j));!function(e){e.LoadWorklogs="WORKLOGS_LOAD",e.LoadedWorklogs="WORKLOGS_LOADED",e.ErrorLoadingWorklogs="WORKLOGS_ERROR"}(P||(P={}));var N,D=Object(i.b)(P.LoadWorklogs),I=Object(i.b)(P.LoadedWorklogs),A=Object(i.b)(P.ErrorLoadingWorklogs);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var W=Object(i.c)({isFetchingWorklogs:!1,month:null,year:null,user:null,worklogs:null,error:null},(N={},Object(l.a)(N,P.LoadWorklogs,(function(e,t){return R({},e,{user:t.payload.user,month:t.payload.month,year:t.payload.year,isFetchingWorklogs:!0,error:null})})),Object(l.a)(N,P.LoadedWorklogs,(function(e,t){return R({},e,{worklogs:t.payload,isFetchingWorklogs:!1})})),Object(l.a)(N,P.ErrorLoadingWorklogs,(function(e,t){return R({},e,{error:t.payload,isFetchingWorklogs:!1})})),N)),T=Object(y.combineReducers)({appState:E,login:L,worklogs:W}),Y=n(18),U=n(45),F=n.n(U),M=function(){return F.a.get("/api/users/current")},x=function(e){return function(t){t(v()),function(e){return F.a.post("/api/users/authenticate",e)}(e).then((function(){return t(w()),M()})).then((function(e){t(m(e.data)),t(f(!0))})).catch((function(e){t(k(e.response&&e.response.status))}))}},z=function(){return function(e){e(d()),F.a.post("api/users/logout").then((function(){return e(p())}))}},G=n(67),K=n(55),q=(n(243),n(419)),B=n(418),H=n(422),V=n(423),J=n(160),Z=q.a.Text,Q=B.a.create({name:"login"})((function(e){var t=e.onSubmit,n=e.isLoggingIn,r=e.loginError,a=e.form,c=a.getFieldDecorator;return o.a.createElement(B.a,{onSubmit:function(e){e.preventDefault(),a.validateFields((function(e,n){e||t(n)}))}},o.a.createElement(B.a.Item,null,c("email",{rules:[{required:!0,message:"Please input your email"}]})(o.a.createElement(H.a,{placeholder:"Email"}))),o.a.createElement(B.a.Item,null,c("url",{rules:[{required:!0,message:"Please input URL"}]})(o.a.createElement(H.a,{addonBefore:"https://",placeholder:"URL"}))),o.a.createElement(B.a.Item,null,c("apiToken",{rules:[{required:!0,message:"Please input token"}]})(o.a.createElement(H.a,{placeholder:"Token"}))),o.a.createElement(B.a.Item,null,c("rememberMe",{valuePropName:"checked",initialValue:!0})(o.a.createElement(V.a,null,"Remember me"))),o.a.createElement(J.a,{loading:n,type:"primary",htmlType:"submit",className:"login-form__button"},"Log in"),r&&o.a.createElement("div",{className:"login-form__error"},o.a.createElement(Z,{type:"danger"},"Incorrect login data")))})),X=n(413),$=n(72),ee=n(40),te=n(417),ne=(n(375),function(){var e=Object(Y.c)(),t=Object(Y.d)((function(e){return e.appState.isAuthenticated})),n=Object(Y.d)((function(e){return e.login.isLoggingIn})),r=Object(Y.d)((function(e){return e.login.error}));return t?o.a.createElement(K.a,{to:{pathname:"dashboard"}}):o.a.createElement(X.a,{style:{height:"100%"}},o.a.createElement(X.a.Content,{style:{padding:"50px 50px"}},o.a.createElement($.a,{className:"login__card-wrapper"},o.a.createElement(ee.a,{md:{span:12,offset:6},xl:{span:8,offset:8}},o.a.createElement(te.a,{className:"login__card"},o.a.createElement("h2",null,"Sign in"),o.a.createElement(Q,{onSubmit:function(t){return x(t)(e)},isLoggingIn:n,loginError:r}))))))}),re=n(415),ae=n(122),oe=n(14),ce=n.n(oe),ue=function(e){var t=e.from,n=e.to,r=e.user,a=function(e){var t=e.from,n=e.to;return{from:ce()(t).format("YYYY-MM-DD"),to:ce()(n).format("YYYY-MM-DD")}}({from:t,to:n});return F.a.get("/api/worklogs?from=".concat(a.from,"&to=").concat(a.to,"&accountId=").concat(r.accountId))},ie=n(159),le=n.n(ie),se=function(e){return{from:e.startOf("month").toDate(),to:e.endOf("month").toDate()}};var me=n(116),fe=n(414),de=n(421),pe=n(11),ge=n(420),be=n(126);function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ee=function(e,t){return e?e.reduce((function(e,n){return function(e,t){var n=Object.assign({},e);return Object.keys(t).reduce((function(e,n){var r=t[n],a=e[n]||[],o=[].concat(Object(be.a)(a),Object(be.a)(r));return Oe({},e,Object(l.a)({},n,o))}),n)}(e,n.worklogs.reduce((function(e,r){var a=function(e,t){return le.a.tz(le()(e),t)}(r.started,t).format("YYYY-MM-DD"),o=e[a]||[],c=[].concat(Object(be.a)(o),[{issueKey:n.issueKey,timeSpent:r.timeSpentSeconds,started:r.started}]);return Oe({},e,Object(l.a)({},a,c))}),{}))}),{}):{}},ye=(n(380),function(e){var t=Math.floor(e/3600),n=e/60%60,r=n<10?"0".concat(n):"".concat(n);return"".concat(t,":").concat(r)}),je=q.a.Text,ve=function(e,t){return"https://".concat(e,"/browse/").concat(t)},we=function(e,t){return function(n){var r=n.format("YYYY-MM-DD"),a=e[r],c=a&&a.reduce((function(e,t){return e+t.timeSpent}),0),u=28800===c;return o.a.createElement("div",{className:"ant-fullcalendar-date"},o.a.createElement("div",{className:"ant-fullcalendar-value callendar-cell__header"},a&&o.a.createElement("span",{className:"callendar-cell__total-time"},o.a.createElement(je,{type:u?void 0:"warning"},"Total: ",ye(c)," ")),o.a.createElement("span",{className:"callendar-cell__day"},n.date())),o.a.createElement("div",{className:"ant-fullcalendar-content"},a&&o.a.createElement("div",null,o.a.createElement("ul",{className:"worklogs"},a.map((function(e,n){return o.a.createElement("li",{className:"worklog-list-item",key:"".concat(e.issueKey,"_").concat(n)},o.a.createElement("a",{target:"_blank",href:ve(t,e.issueKey)},e.issueKey),o.a.createElement("span",null,ye(e.timeSpent)))}))))))}},ke=(n(381),n(123)),Se=(n(382),n(68)),_e=n.n(Se),Pe=function(e){return function(t){var n;e({data:[],fetching:!0}),t&&(n=t,F.a.get("/api/users/search",{params:{query:n}})).then((function(e){return e.data})).then((function(t){e({data:t,fetching:!1})}))}},Le=function(e){var t=e.user,n=e.onUserSelect,r=Object(a.useState)({data:[],value:t.displayName,fetching:!1}),o=Object(me.a)(r,2),c=o[0],u=o[1],i=_e()(Pe(u),800);return a.createElement("div",{className:"user__search"},a.createElement(ke.a,{showSearch:!0,style:{width:"100%"},placeholder:"Select user",value:c.value,onSearch:i,onChange:function(e){var t=c.data.find((function(t){return t.accountId===e}));u({value:t&&t.displayName,data:[],fetching:!1}),t&&n(t)},showArrow:!1,filterOption:!1,defaultActiveFirstOption:!1,notFoundContent:c.fetching?a.createElement(fe.a,{size:"small"}):null},c.data.map((function(e){return a.createElement(ke.a.Option,{key:e.accountId},e.displayName)}))))},Ne=function(e){return e?e.reduce((function(e,t){return e+t.worklogs.reduce((function(e,t){return e+t.timeSpentSeconds}),0)}),0):0},De=function(e){return{year:e.year(),month:e.month()}},Ie=function(e){var t=e.url,n=e.onViewChanged,r=e.isFetchingWorklogs,c=e.userTimezone,u=e.worklogs,i=e.month,l=e.year,s=e.userWorklogs,m=Object(a.useState)(ce()([l,i])),f=Object(me.a)(m,2),d=f[0],p=f[1];Object(a.useEffect)((function(){return window.addEventListener("keyup",E),function(){window.removeEventListener("keyup",E)}}));var g=function(e){if(e){var t=d.clone();if(p(e),!e.clone().startOf("month").isSame(t.clone().startOf("month"))){var r=De(e),a=r.year,o=r.month;n(a,o,s)}}},b=function(){var e=d.clone().add(1,"month");g(e)},h=function(){var e=d.clone().subtract(1,"month");g(e)},O=function(){var e=De(d),t=e.year,r=e.month;n(t,r,s)},E=function(e){switch(e.key){case"ArrowLeft":h();break;case"ArrowRight":b();break;case"r":O()}},y=Ee(u,c),j=we(y,t);return o.a.createElement(fe.a,{spinning:r},o.a.createElement("div",{className:"worklog-calendar__header"},o.a.createElement("div",{className:"worklog-calendar__total-summary"},o.a.createElement(de.a,{title:"Total logged:",value:ye(Ne(u))})),o.a.createElement("div",{className:"worklog-calendar__user"},o.a.createElement(Le,{user:s,onUserSelect:function(e){if(e.accountId!==s.accountId){var t=De(d),r=t.year,a=t.month;n(r,a,e)}}})),o.a.createElement(J.a.Group,null,o.a.createElement(J.a,{type:"primary",onClick:h},o.a.createElement(pe.a,{type:"left"}),"Backward"),o.a.createElement(J.a,{type:"primary",onClick:O},o.a.createElement(pe.a,{type:"sync"}),"Refresh(R)"),o.a.createElement(J.a,{type:"primary",onClick:b},"Forward",o.a.createElement(pe.a,{type:"right"})))),o.a.createElement(ge.a,{value:d,onChange:g,dateFullCellRender:j}))},Ae=(n(403),X.a.Content),Ce=(X.a.Sider,function(){var e=Object(Y.c)(),t=function(t,n,r){var a;(a={from:t,to:n,user:r},function(e){var t=a.from.getMonth(),n=a.from.getFullYear();e(D({user:a.user,month:t,year:n})),ue(a).then((function(t){e(I(t.data))})).catch((function(){e(A())}))})(e)},n=Object(Y.d)((function(e){return e.worklogs.isFetchingWorklogs})),r=Object(Y.d)((function(e){return e.appState.user})),c=Object(Y.d)((function(e){return e.appState.url}))||"",u=Object(Y.d)((function(e){var t=e.appState.user;return t&&t.timeZone})),i=Object(Y.d)((function(e){return e.worklogs.error})),l=Object(K.g)(),s=new URLSearchParams(Object(K.h)().search),m=Object(Y.d)((function(e){return e.worklogs})),f=m.worklogs,d=m.month,p=m.year,g=m.user;Object(a.useEffect)((function(){i&&re.a.error("Could not fetch worklogs. Please try again.")})),Object(a.useEffect)((function(){var e=se(function(e){var t=e.month,n=e.year;return t&&n?ce()([n,t]):ce()()}({year:s.get("year"),month:s.get("month")})),n=e.from,a=e.to,o=s.get("user");o?function(e){var t=encodeURIComponent(e);return F.a.get("/api/users/".concat(t))}(o).then((function(e){var r=e.data;t(n,a,r)})).catch((function(){re.a.error("Could not fetch user with accountID: ".concat(o))})):t(n,a,r)}),[]);return o.a.createElement("div",{className:"home__container"},Object(ae.isNil)(g)||Object(ae.isNil)(d)||Object(ae.isNil)(p)?"":o.a.createElement(X.a,null,o.a.createElement(Ae,{className:"home__content"},o.a.createElement(Ie,{url:c,userWorklogs:g,isFetchingWorklogs:n,onViewChanged:function(e,n,r){var a=se(ce()([e,n])),o=a.from,c=a.to;!function(e,t,n){l.push("?&year=".concat(e,"&month=").concat(t,"&user=").concat(n.accountId))}(e,n,r),t(o,c,r)},month:d,year:p,worklogs:f,userTimezone:u}))))}),Re=n(211),We=(n(404),n(424)),Te=n(115),Ye=(n(405),function(e){var t=e.user,n=e.onLogout,r=e.children;return o.a.createElement(We.a,{theme:"dark",mode:"horizontal",className:"user-info__menu",selectable:!1},o.a.createElement(Te.a,{title:o.a.createElement("span",null,o.a.createElement(pe.a,{type:"user"}),t.displayName)},o.a.createElement(We.a.Item,{disabled:!0},o.a.createElement("img",{alt:"avatar",src:t.avatarUrls["32x32"],className:"user-info__avatar"}),t.emailAddress),o.a.createElement(We.a.Item,{disabled:!0},"Timezone: ",t.timeZone),o.a.createElement(We.a.Item,{onClick:n},o.a.createElement(pe.a,{type:"logout"}),"Logout")),r&&o.a.createElement(We.a.Item,{className:"user-info__extras"},r))}),Ue=X.a.Header,Fe=X.a.Content,Me=function(e){var t=e.children,n=Object(Y.c)(),r=Object(Y.d)((function(e){return e.appState.user}));return o.a.createElement(X.a,{className:"main-layout"},o.a.createElement(Ue,{className:"main-layout__header"},o.a.createElement(Ye,{user:r,onLogout:function(){return n(z())}},o.a.createElement("a",{href:"https://github.com/iczajkow/jira-web-timesheet",target:"_blank"},o.a.createElement(pe.a,{type:"github",style:{fontSize:"24px"}})))),o.a.createElement(Fe,{className:"main-layout__content"},t))},xe=function(e){var t=e.children,n=Object(Re.a)(e,["children"]),r=Object(Y.d)((function(e){return e.appState.isAuthenticated}));return o.a.createElement(K.b,Object.assign({},n,{render:function(e){var n=e.location;return r?o.a.createElement(Me,null,t):o.a.createElement(K.a,{to:{pathname:"/login",state:{from:n}}})}}))},ze=function(){return o.a.createElement(G.a,null,o.a.createElement(K.d,null,o.a.createElement(K.b,{path:"/login"},o.a.createElement(ne,null)),o.a.createElement(xe,{path:"/dashboard"},o.a.createElement(Ce,null)),o.a.createElement(K.b,{path:"*"},o.a.createElement(K.a,{to:{pathname:"dashboard"}}))))},Ge={checkAuthenticationConnect:function(){return function(e){M().then((function(t){e(m(t.data)),e(f(!0))})).catch((function(){e(f(!1))}))}}},Ke=Object(Y.b)((function(e){return{isAuthenticated:e.appState.isAuthenticated}}),Ge)((function(e){var t=e.checkAuthenticationConnect,n=e.isAuthenticated;return o.a.useEffect((function(){t()}),[]),null!=n?o.a.createElement(ze,null):null})),qe=n(13),Be=(n(406),n(212)),He=n.n(Be),Ve=function(e){var t=e.dispatch;F.a.interceptors.response.use(void 0,(function(e){return 401===e.response.status&&t(p()),Promise.reject(e)}))},Je=n(416),Ze=function(){"https:"===window.location.protocol||function(){var e="open".concat(Date.now()),t=o.a.createElement(J.a,{type:"primary",href:"https://".concat("jira-timesheet.iczajkow.pl")},"Open HTTPs version");Je.a.open({message:"Your connection is not private!",description:"You are using unsecured version of this website. To open secured version click button below.",btn:t,key:e,duration:0})}()},Qe=Object(i.a)({reducer:T});Ve(Qe);var Xe=function(){return Ze(),o.a.createElement(qe.b,{locale:He.a},o.a.createElement(Y.a,{store:Qe},o.a.createElement(Ke,null)))};u.a.render(o.a.createElement(Xe,null),document.getElementById("root"))}},[[216,1,2]]]);
//# sourceMappingURL=main.0d2c895d.chunk.js.map