(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{216:function(e,t,n){e.exports=n(410)},221:function(e,t,n){},222:function(e,t,n){},243:function(e,t,n){},375:function(e,t,n){},380:function(e,t,n){},381:function(e,t,n){},382:function(e,t,n){},403:function(e,t,n){},404:function(e,t,n){},410:function(e,t,n){"use strict";n.r(t);var r,a=n(0),o=n.n(a),c=n(8),u=n.n(c),l=(n(221),n(222),n(21)),i=n(23);!function(e){e.SetUser="APP_SET_USER",e.ClearUser="APP_CLEAR_USER",e.SetAuthenticated="APP_SET_AUTHENTICATED",e.Logout="APP_LOGOUT"}(r||(r={}));var s,m=function(e){return{type:r.SetUser,payload:e}},f=Object(l.b)(r.SetAuthenticated),p=Object(l.b)(r.Logout),d=Object(l.b)(r.ClearUser);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O,h={url:null,user:null,isAuthenticated:void 0},y=Object(l.c)(h,(s={},Object(i.a)(s,r.SetUser,(function(e,t){return b({},e,{user:t.payload.user,url:t.payload.url})})),Object(i.a)(s,r.ClearUser,(function(e){return b({},e,{user:null,isAuthenticated:!1})})),Object(i.a)(s,r.SetAuthenticated,(function(e,t){return b({},e,{isAuthenticated:t.payload})})),s)),E=n(35);!function(e){e.Login="LOGIN_LOGIN",e.LoginSuccess="LOGIN_SUCCESS",e.SetError="LOGIN_SET_ERROR"}(O||(O={}));var j,v=Object(l.b)(O.Login),w=Object(l.b)(O.LoginSuccess),k=Object(l.b)(O.SetError);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(n,!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P,L=Object(l.c)({isLoggingIn:!1,error:null},(j={},Object(i.a)(j,O.Login,(function(e){return _({},e,{isLoggingIn:!0})})),Object(i.a)(j,O.LoginSuccess,(function(e){return _({},e,{isLoggingIn:!1})})),Object(i.a)(j,O.SetError,(function(e,t){return _({},e,{error:t.payload,isLoggingIn:!1})})),j));!function(e){e.LoadWorklogs="WORKLOGS_LOAD",e.LoadedWorklogs="WORKLOGS_LOADED",e.ErrorLoadingWorklogs="WORKLOGS_ERROR"}(P||(P={}));var D,N=Object(l.b)(P.LoadWorklogs),I=Object(l.b)(P.LoadedWorklogs),A=Object(l.b)(P.ErrorLoadingWorklogs);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R=Object(l.c)({isFetchingWorklogs:!1,month:null,year:null,user:null,worklogs:null,error:null},(D={},Object(i.a)(D,P.LoadWorklogs,(function(e,t){return W({},e,{user:t.payload.user,month:t.payload.month,year:t.payload.year,isFetchingWorklogs:!0,error:null})})),Object(i.a)(D,P.LoadedWorklogs,(function(e,t){return W({},e,{worklogs:t.payload,isFetchingWorklogs:!1})})),Object(i.a)(D,P.ErrorLoadingWorklogs,(function(e,t){return W({},e,{error:t.payload,isFetchingWorklogs:!1})})),D)),T=Object(E.combineReducers)({appState:y,login:L,worklogs:R}),Y=n(18),U=n(36),F=n.n(U),M=n(67),x=n(55),z=(n(243),n(418)),G=n(417),K=n(421),q=n(422),H=n(160),V=z.a.Text,B=G.a.create({name:"login"})((function(e){var t=e.onSubmit,n=e.isLoggingIn,r=e.loginError,a=e.form,c=a.getFieldDecorator;return o.a.createElement(G.a,{onSubmit:function(e){e.preventDefault(),a.validateFields((function(e,n){e||t(n)}))}},o.a.createElement(G.a.Item,null,c("email",{rules:[{required:!0,message:"Please input your email"}]})(o.a.createElement(K.a,{placeholder:"Email"}))),o.a.createElement(G.a.Item,null,c("url",{rules:[{required:!0,message:"Please input URL"}]})(o.a.createElement(K.a,{placeholder:"URL"}))),o.a.createElement(G.a.Item,null,c("apiToken",{rules:[{required:!0,message:"Please input token"}]})(o.a.createElement(K.a,{placeholder:"Token"}))),o.a.createElement(G.a.Item,null,c("rememberMe",{valuePropName:"checked",initialValue:!0})(o.a.createElement(q.a,null,"Remember me"))),o.a.createElement(H.a,{loading:n,type:"primary",htmlType:"submit",className:"login-form__button"},"Log in"),r&&o.a.createElement("div",{className:"login-form__error"},o.a.createElement(V,{type:"danger"},"Incorrect login data")))})),J=n(412),Z=n(72),Q=n(41),X=n(416),$=(n(375),function(){var e=Object(Y.c)(),t=Object(Y.d)((function(e){return e.appState.isAuthenticated})),n=Object(Y.d)((function(e){return e.login.isLoggingIn})),r=Object(Y.d)((function(e){return e.login.error}));return t?o.a.createElement(x.a,{to:{pathname:"dashboard"}}):o.a.createElement(J.a,{style:{height:"100%"}},o.a.createElement(J.a.Content,{style:{padding:"50px 50px"}},o.a.createElement(Z.a,{className:"login__card-wrapper"},o.a.createElement(Q.a,{md:{span:12,offset:6},xl:{span:8,offset:8}},o.a.createElement(X.a,{className:"login__card"},o.a.createElement("h2",null,"Sign in"),o.a.createElement(B,{onSubmit:function(t){return(n=t,function(e){e(v()),F.a.post("/api/users/authenticate",n).then((function(t){return e(w()),F.a.get("/api/users/current")})).then((function(t){e(m(t.data)),e(f(!0))})).catch((function(t){e(k(t.response&&t.response.status))}))})(e);var n},isLoggingIn:n,loginError:r}))))))}),ee=n(14),te=n.n(ee),ne=function(e){var t=e.from,n=e.to,r=e.user;return function(e){var a=function(e){var t=e.from,n=e.to;return{from:te()(t).format("YYYY-MM-DD"),to:te()(n).format("YYYY-MM-DD")}}({from:t,to:n}),o=t.getMonth(),c=t.getFullYear();e(N({user:r,month:o,year:c})),F.a.get("/api/worklogs?from=".concat(a.from,"&to=").concat(a.to,"&accountId=").concat(r.accountId)).then((function(t){e(I(t.data))})).catch((function(){e(A())}))}},re=n(116),ae=n(413),oe=n(420),ce=n(11),ue=n(419),le=n(126),ie=n(159),se=n.n(ie),me=function(e){return{from:e.startOf("month").toDate(),to:e.endOf("month").toDate()}};function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(n,!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var de=function(e,t){return e?e.reduce((function(e,n){return function(e,t){var n=Object.assign({},e);return Object.keys(t).reduce((function(e,n){var r=t[n],a=e[n]||[],o=[].concat(Object(le.a)(a),Object(le.a)(r));return pe({},e,Object(i.a)({},n,o))}),n)}(e,n.worklogs.reduce((function(e,r){var a=function(e,t){return se.a.tz(se()(e),t)}(r.started,t).format("YYYY-MM-DD"),o=e[a]||[],c=[].concat(Object(le.a)(o),[{issueKey:n.issueKey,timeSpent:r.timeSpentSeconds,started:r.started}]);return pe({},e,Object(i.a)({},a,c))}),{}))}),{}):{}},ge=(n(380),function(e){var t=Math.floor(e/3600),n=e/60%60,r=n<10?"0".concat(n):"".concat(n);return"".concat(t,":").concat(r)}),be=z.a.Text,Oe=function(e,t){return"https://".concat(e,"/browse/").concat(t)},he=function(e,t){return function(n){var r=n.format("YYYY-MM-DD"),a=e[r],c=a&&a.reduce((function(e,t){return e+t.timeSpent}),0),u=28800===c;return o.a.createElement("div",{className:"ant-fullcalendar-date"},o.a.createElement("div",{className:"ant-fullcalendar-value callendar-cell__header"},a&&o.a.createElement("span",{className:"callendar-cell__total-time"},o.a.createElement(be,{type:u?void 0:"warning"},"Total: ",ge(c)," ")),o.a.createElement("span",{className:"callendar-cell__day"},n.date())),o.a.createElement("div",{className:"ant-fullcalendar-content"},a&&o.a.createElement("div",null,o.a.createElement("ul",{className:"worklogs"},a.map((function(e){return o.a.createElement("li",{className:"worklog-list-item",key:e.issueKey},o.a.createElement("a",{target:"_blank",href:Oe(t,e.issueKey)},e.issueKey),o.a.createElement("span",null,ge(e.timeSpent)))}))))))}},ye=(n(381),n(122)),Ee=(n(382),n(68)),je=n.n(Ee),ve=function(e){return function(t){var n;e({data:[],fetching:!0}),t&&(n=t,F.a.get("/api/users/search",{params:{query:n}})).then((function(e){return e.data})).then((function(t){e({data:t,fetching:!1})}))}},we=function(e){var t=e.user,n=e.onUserSelect,r=Object(a.useState)({data:[],value:t.displayName,fetching:!1}),o=Object(re.a)(r,2),c=o[0],u=o[1],l=je()(ve(u),800);return a.createElement("div",{className:"user__search"},a.createElement(ye.a,{showSearch:!0,style:{width:"100%"},placeholder:"Select user",value:c.value,onSearch:l,onChange:function(e){var t=c.data.find((function(t){return t.accountId===e}));u({value:t&&t.displayName,data:[],fetching:!1}),t&&n(t)},showArrow:!1,filterOption:!1,defaultActiveFirstOption:!1,notFoundContent:c.fetching?a.createElement(ae.a,{size:"small"}):null},c.data.map((function(e){return a.createElement(ye.a.Option,{key:e.accountId},e.displayName)}))))},ke=function(e){return e?e.reduce((function(e,t){return e+t.worklogs.reduce((function(e,t){return e+t.timeSpentSeconds}),0)}),0):0},Se=function(e){return{year:e.year(),month:e.month()}},_e=function(e){var t=e.url,n=e.onViewChanged,r=e.isFetchingWorklogs,c=e.userTimezone,u=e.worklogs,l=e.month,i=e.year,s=e.userWorklogs,m=Object(a.useState)(te()([i,l])),f=Object(re.a)(m,2),p=f[0],d=f[1],g=function(e){if(d(e),!e.startOf("month").isSame(p.startOf("month"))){var t=Se(e),r=t.year,a=t.month;n(r,a,s)}},b=de(u,c),O=he(b,t);return o.a.createElement(ae.a,{spinning:r},o.a.createElement("div",{className:"worklog-calendar__header"},o.a.createElement("div",{className:"worklog-calendar__total-summary"},o.a.createElement(oe.a,{title:"Total logged:",value:ge(ke(u))})),o.a.createElement("div",{className:"worklog-calendar__user"},o.a.createElement(we,{user:s,onUserSelect:function(e){if(e.accountId!==s.accountId){var t=Se(p),r=t.year,a=t.month;n(r,a,e)}}})),o.a.createElement(H.a.Group,null,o.a.createElement(H.a,{type:"primary",onClick:function(){var e=p.clone().subtract(1,"month");g(e)}},o.a.createElement(ce.a,{type:"left"}),"Backward"),o.a.createElement(H.a,{type:"primary",onClick:function(){var e=Se(p),t=e.year,r=e.month;n(t,r,s)}},o.a.createElement(ce.a,{type:"sync"}),"Refresh"),o.a.createElement(H.a,{type:"primary",onClick:function(){var e=p.clone().add(1,"month");g(e)}},"Forward",o.a.createElement(ce.a,{type:"right"})))),o.a.createElement(ue.a,{value:p,onChange:g,dateFullCellRender:O}))},Pe=n(414),Le=n(125);var De=function(){var e=Object(Y.c)(),t=function(t,n,r){ne({from:t,to:n,user:r})(e)},n=Object(Y.d)((function(e){return e.worklogs.isFetchingWorklogs})),r=Object(Y.d)((function(e){return e.appState.user})),c=Object(Y.d)((function(e){return e.appState.url}))||"",u=Object(Y.d)((function(e){var t=e.appState.user;return t&&t.timeZone})),l=Object(Y.d)((function(e){return e.worklogs.error})),i=Object(x.g)(),s=new URLSearchParams(Object(x.h)().search),m=Object(Y.d)((function(e){return e.worklogs})),f=m.worklogs,p=m.month,d=m.year,g=m.user;Object(a.useEffect)((function(){l&&Pe.a.error("Could not fetch worklogs. Please try again.")})),Object(a.useEffect)((function(){var e=me(function(e){var t=e.month,n=e.year;return t&&n?te()([n,t]):te()()}({year:s.get("year"),month:s.get("month")})),n=e.from,a=e.to,o=s.get("user");o?function(e){var t=encodeURIComponent(e);return F.a.get("/api/users/".concat(t))}(o).then((function(e){var r=e.data;t(n,a,r)})).catch((function(e){Pe.a.error("Could not fetch user with accountID: ".concat(o))})):t(n,a,r)}),[]);return o.a.createElement("div",{style:{background:"white",flex:1}},Object(Le.isNil)(g)||Object(Le.isNil)(p)||Object(Le.isNil)(d)?"":o.a.createElement(_e,{url:c,userWorklogs:g,isFetchingWorklogs:n,onViewChanged:function(e,n,r){var a=me(te()([e,n])),o=a.from,c=a.to;!function(e,t,n){i.push("?&year=".concat(e,"&month=").concat(t,"&user=").concat(n.accountId))}(e,n,r),t(o,c,r)},month:p,year:d,worklogs:f,userTimezone:u}))},Ne=n(211),Ie=(n(403),n(423)),Ae=n(115),Ce=(n(404),function(e){var t=e.user,n=e.onLogout,r=e.children;return o.a.createElement(Ie.a,{theme:"dark",mode:"horizontal",className:"user-info__menu",selectable:!1},o.a.createElement(Ae.a,{title:o.a.createElement("span",null,o.a.createElement(ce.a,{type:"user"}),t.displayName)},o.a.createElement(Ie.a.Item,{disabled:!0},o.a.createElement("img",{alt:"avatar",src:t.avatarUrls["32x32"],className:"user-info__avatar"}),t.emailAddress),o.a.createElement(Ie.a.Item,{disabled:!0},"Timezone: ",t.timeZone),o.a.createElement(Ie.a.Item,{onClick:n},o.a.createElement(ce.a,{type:"logout"}),"Logout")),r&&o.a.createElement(Ie.a.Item,{className:"user-info__extras"},r))}),We=J.a.Header,Re=J.a.Content,Te=(J.a.Footer,function(e){var t=e.children,n=Object(Y.c)(),r=Object(Y.d)((function(e){return e.appState.user}));return o.a.createElement(J.a,{className:"main-layout"},o.a.createElement(We,{className:"main-layout__header"},o.a.createElement(Ce,{user:r,onLogout:function(){return n((function(e){e(p()),F.a.post("api/users/logout").then((function(){return e(d())}))}))}},o.a.createElement("a",{href:"https://github.com/iczajkow/jira-web-timesheet",target:"_blank"},o.a.createElement(ce.a,{type:"github",style:{fontSize:"24px"}})))),o.a.createElement(Re,{className:"main-layout__content"},t))}),Ye=function(e){var t=e.children,n=Object(Ne.a)(e,["children"]),r=Object(Y.d)((function(e){return e.appState.isAuthenticated}));return o.a.createElement(x.b,Object.assign({},n,{render:function(e){var n=e.location;return r?o.a.createElement(Te,null,t):o.a.createElement(x.a,{to:{pathname:"/login",state:{from:n}}})}}))},Ue=function(){return o.a.createElement(M.a,null,o.a.createElement(x.d,null,o.a.createElement(x.b,{path:"/login"},o.a.createElement($,null)),o.a.createElement(Ye,{path:"/dashboard"},o.a.createElement(De,null)),o.a.createElement(x.b,{path:"*"},o.a.createElement(x.a,{to:{pathname:"dashboard"}}))))},Fe={checkAuthenticationConnect:function(){return function(e){F.a.get("/api/users/current").then((function(t){e(m(t.data)),e(f(!0))})).catch((function(){e(f(!1))}))}}},Me=Object(Y.b)((function(e){return{isAuthenticated:e.appState.isAuthenticated}}),Fe)((function(e){var t=e.checkAuthenticationConnect,n=e.isAuthenticated;return o.a.useEffect((function(){t()}),[]),null!=n?o.a.createElement(Ue,null):null})),xe=n(13),ze=(n(405),n(212)),Ge=n.n(ze),Ke=function(e){var t=e.dispatch;F.a.interceptors.response.use(void 0,(function(e){401===e.response.status&&t(d())}))},qe=n(415),He=function(){"https:"===window.location.protocol||function(){var e="open".concat(Date.now()),t=o.a.createElement(H.a,{type:"primary",href:"https://".concat("jira-timesheet.iczajkow.pl")},"Open HTTPs version");qe.a.open({message:"Your connection is not private!",description:"You are using unsecured version of this website. To open secured version click button below.",btn:t,key:e,duration:0})}()},Ve=Object(l.a)({reducer:T});Ke(Ve);var Be=function(){return He(),o.a.createElement(xe.b,{locale:Ge.a},o.a.createElement(Y.a,{store:Ve},o.a.createElement(Me,null)))};u.a.render(o.a.createElement(Be,null),document.getElementById("root"))}},[[216,1,2]]]);
//# sourceMappingURL=main.395099cb.chunk.js.map