(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{216:function(e,t,n){e.exports=n(410)},221:function(e,t,n){},222:function(e,t,n){},243:function(e,t,n){},375:function(e,t,n){},380:function(e,t,n){},381:function(e,t,n){},382:function(e,t,n){},403:function(e,t,n){},404:function(e,t,n){},410:function(e,t,n){"use strict";n.r(t);var r,a=n(0),o=n.n(a),c=n(8),u=n.n(c),i=(n(221),n(222),n(21)),l=n(23);!function(e){e.SetUser="APP_SET_USER",e.ClearUser="APP_CLEAR_USER",e.SetAuthenticated="APP_SET_AUTHENTICATED",e.Logout="APP_LOGOUT"}(r||(r={}));var s,m=function(e){return{type:r.SetUser,payload:e}},f=Object(i.b)(r.SetAuthenticated),d=Object(i.b)(r.Logout),p=Object(i.b)(r.ClearUser);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O,h={url:null,user:null,isAuthenticated:void 0},y=Object(i.c)(h,(s={},Object(l.a)(s,r.SetUser,(function(e,t){return b({},e,{user:t.payload.user,url:t.payload.url})})),Object(l.a)(s,r.ClearUser,(function(e){return b({},e,{user:null,isAuthenticated:!1})})),Object(l.a)(s,r.SetAuthenticated,(function(e,t){return b({},e,{isAuthenticated:t.payload})})),s)),E=n(35);!function(e){e.Login="LOGIN_LOGIN",e.LoginSuccess="LOGIN_SUCCESS",e.SetError="LOGIN_SET_ERROR"}(O||(O={}));var j,v=Object(i.b)(O.Login),w=Object(i.b)(O.LoginSuccess),k=Object(i.b)(O.SetError);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P,L=Object(i.c)({isLoggingIn:!1,error:null},(j={},Object(l.a)(j,O.Login,(function(e){return _({},e,{isLoggingIn:!0})})),Object(l.a)(j,O.LoginSuccess,(function(e){return _({},e,{isLoggingIn:!1})})),Object(l.a)(j,O.SetError,(function(e,t){return _({},e,{error:t.payload,isLoggingIn:!1})})),j));!function(e){e.LoadWorklogs="WORKLOGS_LOAD",e.LoadedWorklogs="WORKLOGS_LOADED",e.ErrorLoadingWorklogs="WORKLOGS_ERROR"}(P||(P={}));var D,N=Object(i.b)(P.LoadWorklogs),I=Object(i.b)(P.LoadedWorklogs),A=Object(i.b)(P.ErrorLoadingWorklogs);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var W=Object(i.c)({isFetchingWorklogs:!1,month:null,year:null,user:null,worklogs:null,error:null},(D={},Object(l.a)(D,P.LoadWorklogs,(function(e,t){return R({},e,{user:t.payload.user,month:t.payload.month,year:t.payload.year,isFetchingWorklogs:!0,error:null})})),Object(l.a)(D,P.LoadedWorklogs,(function(e,t){return R({},e,{worklogs:t.payload,isFetchingWorklogs:!1})})),Object(l.a)(D,P.ErrorLoadingWorklogs,(function(e,t){return R({},e,{error:t.payload,isFetchingWorklogs:!1})})),D)),T=Object(E.combineReducers)({appState:y,login:L,worklogs:W}),Y=n(18),U=n(45),F=n.n(U),M=function(){return F.a.get("/api/users/current")},x=function(e){return function(t){t(v()),function(e){return F.a.post("/api/users/authenticate",e)}(e).then((function(){return t(w()),M()})).then((function(e){t(m(e.data)),t(f(!0))})).catch((function(e){t(k(e.response&&e.response.status))}))}},z=function(){return function(e){e(d()),F.a.post("api/users/logout").then((function(){return e(p())}))}},G=n(67),K=n(55),q=(n(243),n(418)),H=n(417),V=n(421),B=n(422),J=n(160),Z=q.a.Text,Q=H.a.create({name:"login"})((function(e){var t=e.onSubmit,n=e.isLoggingIn,r=e.loginError,a=e.form,c=a.getFieldDecorator;return o.a.createElement(H.a,{onSubmit:function(e){e.preventDefault(),a.validateFields((function(e,n){e||t(n)}))}},o.a.createElement(H.a.Item,null,c("email",{rules:[{required:!0,message:"Please input your email"}]})(o.a.createElement(V.a,{placeholder:"Email"}))),o.a.createElement(H.a.Item,null,c("url",{rules:[{required:!0,message:"Please input URL"}]})(o.a.createElement(V.a,{placeholder:"URL"}))),o.a.createElement(H.a.Item,null,c("apiToken",{rules:[{required:!0,message:"Please input token"}]})(o.a.createElement(V.a,{placeholder:"Token"}))),o.a.createElement(H.a.Item,null,c("rememberMe",{valuePropName:"checked",initialValue:!0})(o.a.createElement(B.a,null,"Remember me"))),o.a.createElement(J.a,{loading:n,type:"primary",htmlType:"submit",className:"login-form__button"},"Log in"),r&&o.a.createElement("div",{className:"login-form__error"},o.a.createElement(Z,{type:"danger"},"Incorrect login data")))})),X=n(412),$=n(72),ee=n(40),te=n(416),ne=(n(375),function(){var e=Object(Y.c)(),t=Object(Y.d)((function(e){return e.appState.isAuthenticated})),n=Object(Y.d)((function(e){return e.login.isLoggingIn})),r=Object(Y.d)((function(e){return e.login.error}));return t?o.a.createElement(K.a,{to:{pathname:"dashboard"}}):o.a.createElement(X.a,{style:{height:"100%"}},o.a.createElement(X.a.Content,{style:{padding:"50px 50px"}},o.a.createElement($.a,{className:"login__card-wrapper"},o.a.createElement(ee.a,{md:{span:12,offset:6},xl:{span:8,offset:8}},o.a.createElement(te.a,{className:"login__card"},o.a.createElement("h2",null,"Sign in"),o.a.createElement(Q,{onSubmit:function(t){return x(t)(e)},isLoggingIn:n,loginError:r}))))))}),re=n(116),ae=n(14),oe=n.n(ae),ce=n(413),ue=n(420),ie=n(11),le=n(419),se=n(126),me=n(159),fe=n.n(me),de=function(e){return{from:e.startOf("month").toDate(),to:e.endOf("month").toDate()}};function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var be=function(e,t){return e?e.reduce((function(e,n){return function(e,t){var n=Object.assign({},e);return Object.keys(t).reduce((function(e,n){var r=t[n],a=e[n]||[],o=[].concat(Object(se.a)(a),Object(se.a)(r));return ge({},e,Object(l.a)({},n,o))}),n)}(e,n.worklogs.reduce((function(e,r){var a=function(e,t){return fe.a.tz(fe()(e),t)}(r.started,t).format("YYYY-MM-DD"),o=e[a]||[],c=[].concat(Object(se.a)(o),[{issueKey:n.issueKey,timeSpent:r.timeSpentSeconds,started:r.started}]);return ge({},e,Object(l.a)({},a,c))}),{}))}),{}):{}},Oe=(n(380),function(e){var t=Math.floor(e/3600),n=e/60%60,r=n<10?"0".concat(n):"".concat(n);return"".concat(t,":").concat(r)}),he=q.a.Text,ye=function(e,t){return"https://".concat(e,"/browse/").concat(t)},Ee=function(e,t){return function(n){var r=n.format("YYYY-MM-DD"),a=e[r],c=a&&a.reduce((function(e,t){return e+t.timeSpent}),0),u=28800===c;return o.a.createElement("div",{className:"ant-fullcalendar-date"},o.a.createElement("div",{className:"ant-fullcalendar-value callendar-cell__header"},a&&o.a.createElement("span",{className:"callendar-cell__total-time"},o.a.createElement(he,{type:u?void 0:"warning"},"Total: ",Oe(c)," ")),o.a.createElement("span",{className:"callendar-cell__day"},n.date())),o.a.createElement("div",{className:"ant-fullcalendar-content"},a&&o.a.createElement("div",null,o.a.createElement("ul",{className:"worklogs"},a.map((function(e,n){return o.a.createElement("li",{className:"worklog-list-item",key:"".concat(e.issueKey,"_").concat(n)},o.a.createElement("a",{target:"_blank",href:ye(t,e.issueKey)},e.issueKey),o.a.createElement("span",null,Oe(e.timeSpent)))}))))))}},je=(n(381),n(122)),ve=(n(382),n(68)),we=n.n(ve),ke=function(e){return function(t){var n;e({data:[],fetching:!0}),t&&(n=t,F.a.get("/api/users/search",{params:{query:n}})).then((function(e){return e.data})).then((function(t){e({data:t,fetching:!1})}))}},Se=function(e){var t=e.user,n=e.onUserSelect,r=Object(a.useState)({data:[],value:t.displayName,fetching:!1}),o=Object(re.a)(r,2),c=o[0],u=o[1],i=we()(ke(u),800);return a.createElement("div",{className:"user__search"},a.createElement(je.a,{showSearch:!0,style:{width:"100%"},placeholder:"Select user",value:c.value,onSearch:i,onChange:function(e){var t=c.data.find((function(t){return t.accountId===e}));u({value:t&&t.displayName,data:[],fetching:!1}),t&&n(t)},showArrow:!1,filterOption:!1,defaultActiveFirstOption:!1,notFoundContent:c.fetching?a.createElement(ce.a,{size:"small"}):null},c.data.map((function(e){return a.createElement(je.a.Option,{key:e.accountId},e.displayName)}))))},_e=function(e){return e?e.reduce((function(e,t){return e+t.worklogs.reduce((function(e,t){return e+t.timeSpentSeconds}),0)}),0):0},Pe=function(e){return{year:e.year(),month:e.month()}},Le=function(e){var t=e.url,n=e.onViewChanged,r=e.isFetchingWorklogs,c=e.userTimezone,u=e.worklogs,i=e.month,l=e.year,s=e.userWorklogs,m=Object(a.useState)(oe()([l,i])),f=Object(re.a)(m,2),d=f[0],p=f[1];Object(a.useEffect)((function(){return window.addEventListener("keyup",y),function(){window.removeEventListener("keyup",y)}}));var g=function(e){if(!e.startOf("month").isSame(d.startOf("month"))){p(e);var t=Pe(e),r=t.year,a=t.month;n(r,a,s)}},b=function(){var e=d.clone().add(1,"month");g(e)},O=function(){var e=d.clone().subtract(1,"month");g(e)},h=function(){var e=Pe(d),t=e.year,r=e.month;n(t,r,s)},y=function(e){switch(e.key){case"ArrowLeft":O();break;case"ArrowRight":b();break;case"r":h()}},E=be(u,c),j=Ee(E,t);return o.a.createElement(ce.a,{spinning:r},o.a.createElement("div",{className:"worklog-calendar__header"},o.a.createElement("div",{className:"worklog-calendar__total-summary"},o.a.createElement(ue.a,{title:"Total logged:",value:Oe(_e(u))})),o.a.createElement("div",{className:"worklog-calendar__user"},o.a.createElement(Se,{user:s,onUserSelect:function(e){if(e.accountId!==s.accountId){var t=Pe(d),r=t.year,a=t.month;n(r,a,e)}}})),o.a.createElement(J.a.Group,null,o.a.createElement(J.a,{type:"primary",onClick:O},o.a.createElement(ie.a,{type:"left"}),"Backward"),o.a.createElement(J.a,{type:"primary",onClick:h},o.a.createElement(ie.a,{type:"sync"}),"Refresh(R)"),o.a.createElement(J.a,{type:"primary",onClick:b},"Forward",o.a.createElement(ie.a,{type:"right"})))),o.a.createElement(le.a,{value:d,onChange:g,dateFullCellRender:j}))},De=n(414),Ne=n(125);var Ie=function(e){var t=e.from,n=e.to,r=e.user,a=function(e){var t=e.from,n=e.to;return{from:oe()(t).format("YYYY-MM-DD"),to:oe()(n).format("YYYY-MM-DD")}}({from:t,to:n});return F.a.get("/api/worklogs?from=".concat(a.from,"&to=").concat(a.to,"&accountId=").concat(r.accountId))},Ae=function(){var e=Object(Y.c)(),t=function(t,n,r){var a;(a={from:t,to:n,user:r},function(e){var t=a.from.getMonth(),n=a.from.getFullYear();e(N({user:a.user,month:t,year:n})),Ie(a).then((function(t){e(I(t.data))})).catch((function(){e(A())}))})(e)},n=Object(Y.d)((function(e){return e.worklogs.isFetchingWorklogs})),r=Object(Y.d)((function(e){return e.appState.user})),c=Object(Y.d)((function(e){return e.appState.url}))||"",u=Object(Y.d)((function(e){var t=e.appState.user;return t&&t.timeZone})),i=Object(Y.d)((function(e){return e.worklogs.error})),l=Object(K.g)(),s=new URLSearchParams(Object(K.h)().search),m=Object(Y.d)((function(e){return e.worklogs})),f=m.worklogs,d=m.month,p=m.year,g=m.user;Object(a.useEffect)((function(){i&&De.a.error("Could not fetch worklogs. Please try again.")})),Object(a.useEffect)((function(){var e=de(function(e){var t=e.month,n=e.year;return t&&n?oe()([n,t]):oe()()}({year:s.get("year"),month:s.get("month")})),n=e.from,a=e.to,o=s.get("user");o?function(e){var t=encodeURIComponent(e);return F.a.get("/api/users/".concat(t))}(o).then((function(e){var r=e.data;t(n,a,r)})).catch((function(){De.a.error("Could not fetch user with accountID: ".concat(o))})):t(n,a,r)}),[]);return o.a.createElement("div",{style:{background:"white",flex:1}},Object(Ne.isNil)(g)||Object(Ne.isNil)(d)||Object(Ne.isNil)(p)?"":o.a.createElement(Le,{url:c,userWorklogs:g,isFetchingWorklogs:n,onViewChanged:function(e,n,r){var a=de(oe()([e,n])),o=a.from,c=a.to;!function(e,t,n){l.push("?&year=".concat(e,"&month=").concat(t,"&user=").concat(n.accountId))}(e,n,r),t(o,c,r)},month:d,year:p,worklogs:f,userTimezone:u}))},Ce=n(211),Re=(n(403),n(423)),We=n(115),Te=(n(404),function(e){var t=e.user,n=e.onLogout,r=e.children;return o.a.createElement(Re.a,{theme:"dark",mode:"horizontal",className:"user-info__menu",selectable:!1},o.a.createElement(We.a,{title:o.a.createElement("span",null,o.a.createElement(ie.a,{type:"user"}),t.displayName)},o.a.createElement(Re.a.Item,{disabled:!0},o.a.createElement("img",{alt:"avatar",src:t.avatarUrls["32x32"],className:"user-info__avatar"}),t.emailAddress),o.a.createElement(Re.a.Item,{disabled:!0},"Timezone: ",t.timeZone),o.a.createElement(Re.a.Item,{onClick:n},o.a.createElement(ie.a,{type:"logout"}),"Logout")),r&&o.a.createElement(Re.a.Item,{className:"user-info__extras"},r))}),Ye=X.a.Header,Ue=X.a.Content,Fe=function(e){var t=e.children,n=Object(Y.c)(),r=Object(Y.d)((function(e){return e.appState.user}));return o.a.createElement(X.a,{className:"main-layout"},o.a.createElement(Ye,{className:"main-layout__header"},o.a.createElement(Te,{user:r,onLogout:function(){return n(z())}},o.a.createElement("a",{href:"https://github.com/iczajkow/jira-web-timesheet",target:"_blank"},o.a.createElement(ie.a,{type:"github",style:{fontSize:"24px"}})))),o.a.createElement(Ue,{className:"main-layout__content"},t))},Me=function(e){var t=e.children,n=Object(Ce.a)(e,["children"]),r=Object(Y.d)((function(e){return e.appState.isAuthenticated}));return o.a.createElement(K.b,Object.assign({},n,{render:function(e){var n=e.location;return r?o.a.createElement(Fe,null,t):o.a.createElement(K.a,{to:{pathname:"/login",state:{from:n}}})}}))},xe=function(){return o.a.createElement(G.a,null,o.a.createElement(K.d,null,o.a.createElement(K.b,{path:"/login"},o.a.createElement(ne,null)),o.a.createElement(Me,{path:"/dashboard"},o.a.createElement(Ae,null)),o.a.createElement(K.b,{path:"*"},o.a.createElement(K.a,{to:{pathname:"dashboard"}}))))},ze={checkAuthenticationConnect:function(){return function(e){M().then((function(t){e(m(t.data)),e(f(!0))})).catch((function(){e(f(!1))}))}}},Ge=Object(Y.b)((function(e){return{isAuthenticated:e.appState.isAuthenticated}}),ze)((function(e){var t=e.checkAuthenticationConnect,n=e.isAuthenticated;return o.a.useEffect((function(){t()}),[]),null!=n?o.a.createElement(xe,null):null})),Ke=n(13),qe=(n(405),n(212)),He=n.n(qe),Ve=function(e){var t=e.dispatch;F.a.interceptors.response.use(void 0,(function(e){401===e.response.status&&t(p())}))},Be=n(415),Je=function(){"https:"===window.location.protocol||function(){var e="open".concat(Date.now()),t=o.a.createElement(J.a,{type:"primary",href:"https://".concat("jira-timesheet.iczajkow.pl")},"Open HTTPs version");Be.a.open({message:"Your connection is not private!",description:"You are using unsecured version of this website. To open secured version click button below.",btn:t,key:e,duration:0})}()},Ze=Object(i.a)({reducer:T});Ve(Ze);var Qe=function(){return Je(),o.a.createElement(Ke.b,{locale:He.a},o.a.createElement(Y.a,{store:Ze},o.a.createElement(Ge,null)))};u.a.render(o.a.createElement(Qe,null),document.getElementById("root"))}},[[216,1,2]]]);
//# sourceMappingURL=main.a869f4aa.chunk.js.map